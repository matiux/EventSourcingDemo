FROM php:7.0-fpm

RUN apt-get update && apt-get install -y \
    git \
    unzip

ADD log.conf /usr/local/etc/php-fpm.d/zz-log.conf

# Set timezone
RUN rm /etc/localtime
RUN ln -s /usr/share/zoneinfo/Europe/Paris /etc/localtime
RUN "date"

# install xdebug
RUN pecl install xdebug
RUN docker-php-ext-enable xdebug
ENV XDEBUGINI_PATH=/usr/local/etc/php/conf.d/docker-php-ext-xdebug.ini
ENV PHP_IDE_CONFIG=serverName=application
ENV XDEBUG_CONFIG=remote_enable=1
RUN echo "xdebug.remote_enable=1" >> $XDEBUGINI_PATH
RUN echo "xdebug.remote_port=9000" >> $XDEBUGINI_PATH
RUN echo "xdebug.remote_handler=dbgp" >> $XDEBUGINI_PATH
RUN echo "xdebug.profiler_enable=0" >> $XDEBUGINI_PATH
RUN echo "xdebug.profiler_enable_trigger=0" >> $XDEBUGINI_PATH
RUN echo "xdebug.idekey=PHPSTORM" >> $XDEBUGINI_PATH
RUN echo "xdebug.remote_connect_back=1" >> $XDEBUGINI_PATH
RUN echo "xdebug.remote_host=`/sbin/ip route|awk '/default/ { print $3 }'`" >> $XDEBUGINI_PATH
RUN echo "xdebug.cli_color=1" >> $XDEBUGINI_PATH


RUN echo "display_errors=On" >> $XDEBUGINI_PATH
RUN echo "error_reporting = E_ALL" >> $XDEBUGINI_PATH


WORKDIR /var/www/app


